package controller;

import java.util.List;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import service.TotalService;
import util.BuyPath;
import vo.ProductVO;

@Controller
public class BuyController implements BuyPath {
	@Autowired
	HttpServletRequest request;

	@Autowired
	ServletContext app;


	private TotalService service;

	@Autowired
	public BuyController(TotalService service) {
		this.service = service;
		System.out.println("Controller 생성자 : " + service);
	} // end of constructor

	@RequestMapping("/buy.do")
	public String buy() {
		return BUYDETAIL;
	}

	@RequestMapping(value = "/preorder.do", produces = "application/json;charset=UTF-8;")
	@ResponseBody
	public String preorder(int amount, int product_preorder_idx, HttpServletRequest request) {
		HttpSession session = request.getSession(); 
		List<int[]> preorder_list = (List<int[]>) (session.getAttribute("preorder_list"));
		if(product_preorder_idx!=0) {
			int[] preorder = { product_preorder_idx, amount };
			preorder_list.add(preorder);			
		}
		List<ProductVO> list = service.selectList_product(preorder_list);
		session.setAttribute("preorder_list", list);
		 

		return "end";
	}

} // end of class
