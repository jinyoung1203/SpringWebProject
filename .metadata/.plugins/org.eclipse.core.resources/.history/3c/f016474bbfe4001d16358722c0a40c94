<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">

<title>safd</title>
<meta content="" name="description">
<meta content="" name="keywords">

<!-- Google Fonts -->
<link href="https://fonts.gstatic.com" rel="preconnect">
<link
	href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
	rel="stylesheet">

<!-- Vendor CSS Files -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
	crossorigin="anonymous">
<link
	href="${pageContext.request.contextPath}/resources/assets/vendor/bootstrap-icons/bootstrap-icons.css"
	rel="stylesheet">

<!-- Template Main CSS File -->
<link
	href="${pageContext.request.contextPath}/resources/assets/css/style.css"
	rel="stylesheet">
<script>
	window.onload = function() {
<%int id_num = 1;%>
	var url = "preorder.do";
		var param = "amount=0&product_preorder_idx=0";
		sendRequest(url, param, resFn, "get");
	}
	function resFn() {
		if (xhr.readyState == 4 && xhr.status == 200) {
		}
	}
	$('.naming').each(function(){
		var url = "producer_name.do";
		var param="producer_idx"+${this}.html();
		sendRequest(url,param,resFn2,"get");
	})
	function resFn2(){
		if (xhr.readyState == 4 && xhr.status == 200) {
			${this}.html=xhr.responseText;
		}
	}
	function amount(fun) {
		let amount = document.getElementById("amount");
		let price = document.getElementById("price");
		let res = amount.innerHTML;
		let minprice= price.innerHTML/res;
		if (fun == '+' && res < 100)
			res++;
		else if (fun == '-' && res > 1)
			res--;
		amount.innerHTML = res;
		price.innerHTML = res * min;
	}
</script>
</head>
<body>
	<h1 style="text-align: center">장바구니</h1>
	<c:set var="producers" value="null"></c:set>
	<c:forEach var="product" items="${preorder_list}">
		<c:if test="${product.producer_idx ne producers}">
			<c:set var="producers" value="${product.producer_idx}"></c:set>
			<div class="card">
				<div class="card-body">
					<div class="naming">${producers}</div>
					<br>
					<c:forEach var="preorder" items="${preorder_list}">
						<c:if test="${preorder.producer_idx eq producers}">
							<table>
								<tr>
									<td rowspan="2">
										<div class="form-check">
											<input class="form-check-input" type="checkbox" value=""
												id="<%=id_num%>번" checked>
											<%
											id_num++;
											%>
										</div>
									</td>
									<td rowspan="2"><a href="#"><img src="#"></a></td>
									<td>${preorder.product_name}</td>
									<td><img src="#" onclick=""></td>
								</tr>
								<form>
									<tr>
										<td>
											<div class="btn-group col-12" role="group"
												aria-label="Basic example">
												<button type="button" class="btn btn-outline-primary col-3"
													onclick="amount('-',this.form);">-</button>
												<button type="button" name="amount"
													class="btn btn-outline-primary col-6 disabled">1</button>
												<button type="button" class="btn btn-outline-primary col-3"
													onclick="amount('+');">+</button>
											</div>
										</td>
										<td><div>
												<span name="price">${preorder.product_price}</span>원
											</div></td>
									</tr>
								</form>
							</table>
						</c:if>
					</c:forEach>


				</div>
			</div>

		</c:if>
	</c:forEach>
	<!-- Vendor JS Files -->
	<script
		src="${pageContext.request.contextPath}/resources/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
</body>
</html>